<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

 <body>
  <!-- üîπ –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
  <div class="navbar">
    <a href="http://127.0.0.1:5500/index.html">–î–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã</a>
    <a href="https://umarfaruh.github.io/financial_management/">–ù–∞–ª–æ–≥–æ–≤—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</a>
    <a href="http://127.0.0.1:5502/index.html">–ù–∞–∫–æ–ø–∏ –Ω–∞ –º–µ—á—Ç—É</a>
    <a href="https://umarfaruh.github.io/mortgage/">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∏–ø–æ—Ç–µ–∫–∏</a>
  </div>

  <style>
    /* üî∏ –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –ø–∞–Ω–µ–ª–∏ */
    .navbar {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 30px;
      background-color: #1e3a8a;
      padding: 24px;
      border-radius: 22px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin: 0px;
    }

    /* üî∏ –ö–Ω–æ–ø–∫–∏ */
    .navbar a {
      background-color: #2563eb;
      color: white;
      text-decoration: none;
      padding: 12px 40px;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    /* üî∏ –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    .navbar a:hover {
      background-color: #1d4ed8;
      transform: translateY(-2px);
    }

    /* üî∏ –î–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–∞–¥–∞–ø—Ç–∏–≤) */
    @media (max-width: 600px) {
      .navbar {
        flex-direction: column;
        align-items: stretch;
      }
      .navbar a {
        width: 100%;
        text-align: center;
      }
    }
  </style>
</body>
  <title>–¢–∞–±–ª–∏—Ü–∞ –±—é–¥–∂–µ—Ç–∞</title>
  <style>
    :root{--bg:#f6f8fb;--card:#ffffff;--accent:#0b74da;--muted:#6b7280}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); margin:0; padding:24px}
    .container{max-width:980px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 20px rgba(11,20,40,0.06)}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:10px 8px;text-align:left;border-bottom:1px solid #eef2f7}
    th{font-size:13px;color:var(--muted);font-weight:600}
    td input[type="number"], td input[type="text"], select{width:100%;border:1px solid #e6eef8;padding:8px;border-radius:6px}
    .actions{display:flex;gap:8px}
    button{background:var(--accent);border:0;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;color:var(--accent);border:1px solid #dbe8fb}
    .muted{color:var(--muted);font-size:13px}
    .totals{display:flex;gap:12px;align-items:center;margin-top:12px}
    .pill{background:#f3f7ff;padding:8px 12px;border-radius:999px;font-weight:600}
    .percent{font-size:13px;color:var(--muted)}
    .controls{display:flex;gap:8px;align-items:center}
    @media (max-width:600px){th:nth-child(3),td:nth-child(3),th:nth-child(4),td:nth-child(4){display:none}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>–†–∞—Å—Å—Ö–æ–¥—ã, –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–π —Å–≤–æ–∏ —Ç—Ä–∞—Ç—ã</h1>
      <div class="controls">
        <button id="addRow">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É</button>
        <button id="save" class="ghost">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button id="clear" class="ghost">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <button id="export" class="ghost">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
      </div>
    </header>

    <section class="card">
      <label class="muted">–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –¥–æ—Ö–æ–¥ (‚Ç∏)</label>
      <input id="income" type="number" value="–Ω–∞–ø–∏—à–∏" style="max-width:220px;margin-top:6px" />

      <table id="budgetTable" aria-label="–¢–∞–±–ª–∏—Ü–∞ –±—é–¥–∂–µ—Ç–∞">
        <thead>
          <tr>
            <th style="width:36%">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
            <th style="width:20%">–¢–∏–ø</th>
            <th style="width:18%">–°—É–º–º–∞ (‚Ç∏)</th>
            <th style="width:16%">–ü—Ä–æ—Ü–µ–Ω—Ç</th>
            <th style="width:10%">–î–µ–π—Å—Ç–≤–∏–µ</th>
          </tr>
        </thead>
        <tbody>
          <!-- rows inserted by JS -->
        </tbody>
      </table>

      <div class="totals">
        <div class="pill">–í—Å–µ–≥–æ: <span id="total">0</span> ‚Ç∏</div>
        <div class="pill">–û—Å—Ç–∞—Ç–æ–∫: <span id="left">0</span> ‚Ç∏</div>
        <div class="percent">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 50/30/20 ‚Äî –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ/–ñ–µ–ª–∞–Ω–∏—è/–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è</div>
      </div>

      <div style="margin-top:14px;display:flex;gap:8px;align-items:center">
        <button id="applySample" class="ghost">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã</button>
        <button id="calcPercent" class="ghost">–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç—ã</button>
        <button id="print" class="ghost">–†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å</button>
      </div>

      <p class="muted" style="margin-top:12px">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –∑–∞–ø–æ–ª–Ω–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —É–∫–∞–∂–∏ —Ç–∏–ø (–ù–µ–æ–±—Ö–æ–¥–∏–º–æ–µ / –ñ–µ–ª–∞–Ω–∏–µ / –ù–∞–∫–æ–ø–ª–µ–Ω–∏—è) ‚Äî —Å–∏—Å—Ç–µ–º–∞ –ø–æ—Å—á–∏—Ç–∞–µ—Ç –∏—Ç–æ–≥ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –¥–æ—Ö–æ–¥–∞. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</p>
    </section>
  </div>

  <script>
    const tbody = document.querySelector('#budgetTable tbody');
    const incomeInput = document.getElementById('income');
    const totalEl = document.getElementById('total');
    const leftEl = document.getElementById('left');

    function createRow(item={category:'',type:'–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ',amount:0}){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input class="cat" type="text" value="${item.category}" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê—Ä–µ–Ω–¥–∞" /></td>
        <td>
          <select class="type">
            <option${item.type==='–£–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ'? ' selected':''}>–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ</option>
            <option${item.type==='–¶–µ–ª—å'? ' selected':''}>–ñ–µ–ª–∞–Ω–∏—è</option>
            <option${item.type==='–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è'? ' selected':''}>–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è</option>
          </select>
        </td>
        <td><input class="amt" type="number" value="${item.amount || 0}" min="0" /></td>
        <td class="pct">0%</td>
        <td><button class="del ghost">–£–¥–∞–ª–∏—Ç—å</button></td>
      `;

      tr.querySelector('.del').addEventListener('click', ()=>{tr.remove(); recalc();});
      tr.querySelectorAll('input, select').forEach(el=>el.addEventListener('input', recalc));
      tbody.appendChild(tr);
      return tr;
    }

    function recalc(){
      const income = Number(incomeInput.value) || 0;
      const rows = Array.from(tbody.querySelectorAll('tr'));
      let sum = 0;
      rows.forEach(r=>{ const a = Number(r.querySelector('.amt').value)||0; sum+=a});
      totalEl.textContent = sum.toLocaleString('ru-RU');
      leftEl.textContent = (income - sum).toLocaleString('ru-RU');

      rows.forEach(r=>{
        const a = Number(r.querySelector('.amt').value)||0;
        const pct = income>0? Math.round((a/income)*1000)/10 : 0; // one decimal
        r.querySelector('.pct').textContent = pct + '%';
      });

      saveToLocal();
    }

    function saveToLocal(){
      const income = Number(incomeInput.value)||0;
      const rows = Array.from(tbody.querySelectorAll('tr')).map(r=>({
        category:r.querySelector('.cat').value,
        type:r.querySelector('.type').value,
        amount:Number(r.querySelector('.amt').value)||0
      }));
      localStorage.setItem('budget_v1', JSON.stringify({income,rows}));
    }

    function loadFromLocal(){
      const raw = localStorage.getItem('budget_v1');
      if(!raw) return false;
      try{
        const data = JSON.parse(raw);
        incomeInput.value = data.income || 0;
        tbody.innerHTML = '';
        (data.rows||[]).forEach(r=>createRow(r));
        recalc();
        return true;
      }catch(e){console.warn(e);}
      return false;
    }

    document.getElementById('addRow').addEventListener('click', ()=>{createRow(); recalc();});
    document.getElementById('save').addEventListener('click', ()=>{saveToLocal(); alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.');});
    document.getElementById('clear').addEventListener('click', ()=>{ if(confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å—Ç—Ä–æ–∫–∏?')){tbody.innerHTML=''; recalc(); localStorage.removeItem('budget_v1');}});
    document.getElementById('applySample').addEventListener('click', ()=>{
      const sample = [
        {category:'–ê—Ä–µ–Ω–¥–∞',type:'–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ',amount:30000},
        {category:'–ü—Ä–æ–¥—É–∫—Ç—ã',type:'–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ',amount:20000},
        {category:'–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç',type:'–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ',amount:4000},
        {category:'–ö–∞—Ñ–µ –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è',type:'–ñ–µ–ª–∞–Ω–∏—è',amount:5000},
        {category:'–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è',type:'–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è',amount:10000}
      ];
      tbody.innerHTML=''; sample.forEach(s=>createRow(s)); recalc();
    });

    document.getElementById('calcPercent').addEventListener('click', recalc);
    document.getElementById('export').addEventListener('click', ()=>{
      const income = Number(incomeInput.value)||0;
      const rows = Array.from(tbody.querySelectorAll('tr')).map(r=>({
        category:r.querySelector('.cat').value,
        type:r.querySelector('.type').value,
        amount:Number(r.querySelector('.amt').value)||0,
        percent: r.querySelector('.pct').textContent
      }));
      let csv = '–ö–∞—Ç–µ–≥–æ—Ä–∏—è,–¢–∏–ø,–°—É–º–º–∞,–ü—Ä–æ—Ü–µ–Ω—Ç\n';
      rows.forEach(r=>{csv += `"${r.category}","${r.type}",${r.amount},${r.percent}\n`;});
      csv += `\n–î–æ—Ö–æ–¥:,${income}\n–í—Å–µ–≥–æ:,${Number(totalEl.textContent.replace(/\s/g,''))}\n–û—Å—Ç–∞—Ç–æ–∫: ,${Number(leftEl.textContent.replace(/\s/g,''))}`;
      const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'budget.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    document.getElementById('print').addEventListener('click', ()=>{window.print();});

    incomeInput.addEventListener('input', recalc);

    // initial
    if(!loadFromLocal()){
      // default rows
      createRow({category: value="–ê—Ä–µ–Ω–¥–∞", type:'–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ',amount:30000});
      createRow({category:'–ü—Ä–æ–¥—É–∫—Ç—ã',type:'–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ',amount:20000});
      createRow({category:'–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç',type:'–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ',amount:4000});
      createRow({category:'–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è',type:'–ñ–µ–ª–∞–Ω–∏—è',amount:5000});
      createRow({category:'–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è',type:'–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è',amount:10000});
      recalc();
    }
  </script>

</body>
</html>

