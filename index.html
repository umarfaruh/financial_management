<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Налоговый калькулятор</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
      function TaxCalculator() {
        const [income, setIncome] = React.useState(500000);
        const [incomePeriod, setIncomePeriod] = React.useState("annual");
        const [deductions, setDeductions] = React.useState(0);
        const [useProgressive, setUseProgressive] = React.useState(false);
        const [flatRate, setFlatRate] = React.useState(13);
        const [brackets, setBrackets] = React.useState([
          { upTo: 100000, rate: 10 },
          { upTo: 300000, rate: 20 },
          { upTo: null, rate: 30 },
        ]);
        const [history, setHistory] = React.useState([]);

        React.useEffect(() => {
          const saved = localStorage.getItem('tax_calc_html');
          if (saved) {
            const p = JSON.parse(saved);
            setIncome(p.income || 0);
            setIncomePeriod(p.incomePeriod || 'annual');
            setDeductions(p.deductions || 0);
            setUseProgressive(p.useProgressive || false);
            setFlatRate(p.flatRate || 13);
            setBrackets(p.brackets || []);
            setHistory(p.history || []);
          }
        }, []);

        React.useEffect(() => {
          localStorage.setItem('tax_calc_html', JSON.stringify({ income, incomePeriod, deductions, useProgressive, flatRate, brackets, history }));
        }, [income, incomePeriod, deductions, useProgressive, flatRate, brackets, history]);

        const toAnnual = (v, p) => (p === 'monthly' ? v * 12 : v);
        const format = (v) => v.toLocaleString('ru-RU', { maximumFractionDigits: 2 });

        function calc() {
          const annualIncome = toAnnual(+income, incomePeriod);
          const taxable = Math.max(0, annualIncome - +deductions);
          let tax = 0;
          if (!useProgressive) {
            tax = taxable * flatRate / 100;
          } else {
            let remain = taxable, lower = 0;
            for (const b of brackets) {
              const upTo = b.upTo == null ? Infinity : b.upTo;
              const part = Math.min(remain, upTo - lower);
              if (part > 0) tax += part * b.rate / 100;
              remain -= part;
              lower = upTo;
              if (remain <= 0) break;
            }
          }
          const net = annualIncome - tax;
          return { annualIncome, taxable, tax, net, netMonthly: net/12 };
        }

        const res = calc();

        return (
          <div className="max-w-3xl mx-auto p-6">
            <h1 className="text-2xl font-bold mb-4">Налоговый калькулятор</h1>

            <div className="space-y-3 bg-white p-4 rounded shadow">
              <div>
                <label>Доход:</label>
                <div className="flex gap-2 mt-1">
                  <input type="number" value={income} onChange={e=>setIncome(+e.target.value)} className="border p-2 rounded flex-1"/>
                  <select value={incomePeriod} onChange={e=>setIncomePeriod(e.target.value)} className="border p-2 rounded">
                    <option value="annual">Годовой</option>
                    <option value="monthly">Месячный</option>
                  </select>
                </div>
              </div>

              <div>
                <label>Вычеты:</label>
                <input type="number" value={deductions} onChange={e=>setDeductions(+e.target.value)} className="border p-2 rounded w-full mt-1"/>
              </div>

              <div className="flex items-center gap-2">
                <input type="checkbox" checked={useProgressive} onChange={e=>setUseProgressive(e.target.checked)}/>
                <label>Прогрессивная шкала</label>
              </div>

              {!useProgressive && (
                <div>
                  <label>Плоская ставка (%)</label>
                  <input type="number" value={flatRate} onChange={e=>setFlatRate(+e.target.value)} className="border p-2 rounded w-full mt-1"/>
                </div>
              )}

              {useProgressive && (
                <div className="space-y-2">
                  {brackets.map((b, i)=>(
                    <div key={i} className="flex gap-2">
                      <input type="number" placeholder="до" value={b.upTo ?? ''} onChange={e=>{
                        const v=e.target.value===''?null:+e.target.value;
                        setBrackets(brackets.map((x,j)=>j===i?{...x,upTo:v}:x));
                      }} className="border p-2 rounded flex-1"/>
                      <input type="number" placeholder="%" value={b.rate} onChange={e=>setBrackets(brackets.map((x,j)=>j===i?{...x,rate:+e.target.value}:x))} className="border p-2 rounded w-24"/>
                    </div>
                  ))}
                  <button onClick={()=>setBrackets([...brackets,{upTo:null,rate:0}])} className="bg-blue-500 text-white px-3 py-1 rounded">Добавить</button>
                </div>
              )}

              <div className="p-4 bg-gray-50 rounded mt-4">
                <div>Годовой доход: <b>{format(res.annualIncome)}</b></div>
                <div>Облагаемый: <b>{format(res.taxable)}</b></div>
                <div>Налог: <b className="text-red-600">{format(res.tax)}</b></div>
                <div>Чистый годовой: <b>{format(res.net)}</b></div>
                <div>Чистый в месяц: <b>{format(res.netMonthly)}</b></div>
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<TaxCalculator/>);
    </script>

    <a href="http://127.0.0.1:5500/index.html" class="btn1"> доходы и расходы</a>
      <style>
      .btn1 {

        display: inline-block;
        padding: 12px 24px;
        background-color: #007bff;
        color: white;
        font-weight: 500;
        text-decoration: none;
        border-radius: 8px;
        transition: background-color 0.3s ease, transform 0.2s ease;
        margin-left: 390px;
      }
 .btn1:hover {
        background-color: #0056b3;
        transform: translateY(-2px);
  }
  
  .btn1:active {
    transform: translateY(0);
  }
  </style>



  <a href="https://umarfaruh.github.io/financial_management/" class="btn">Налоговый калькулятор</a>
      <style>
      .btn {

        display: inline-block;
        padding: 12px 24px;
        background-color: #007bff;
        color: white;
        font-weight: 500;
        text-decoration: none;
        border-radius: 8px;
        transition: background-color 0.3s ease, transform 0.2s ease;
       
      }
 .btn1:hover {
        background-color: #0056b3;
        transform: translateY(-2px);
  }
  
  .btn1:active {
    transform: translateY(0);
  }
  </style>

<a href="http://127.0.0.1:5502/index.html" class="btn">Накопи на свою мечту</a>
      <style>
      .btn {

        display: inline-block;
        padding: 12px 24px;
        background-color: #007bff;
        color: white;
        font-weight: 500;
        text-decoration: none;
        border-radius: 8px;
        transition: background-color 0.3s ease, transform 0.2s ease;
       
      }
 .btn1:hover {
        background-color: #0056b3;
        transform: translateY(-2px);
  }
  
  .btn1:active {
    transform: translateY(0);
  }
  </style>
  </body>
</html>
