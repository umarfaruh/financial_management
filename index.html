<html lang="ru">
  <body>
  <!-- üîπ –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
  <div class="navbar">
    <a href="http://127.0.0.1:5500/index.html">–î–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã</a>
    <a href="https://umarfaruh.github.io/financial_management/">–ù–∞–ª–æ–≥–æ–≤—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</a>
    <a href="http://127.0.0.1:5502/index.html">–ù–∞–∫–æ–ø–∏ –Ω–∞ –º–µ—á—Ç—É</a>
    <a href="https://umarfaruh.github.io/mortgage/">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∏–ø–æ—Ç–µ–∫–∏</a>
  </div>

  <style>
    /* üî∏ –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –ø–∞–Ω–µ–ª–∏ */
    .navbar {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 30px;
      background-color: #1e3a8a;
      padding: 20px;
      border-radius: 0px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin: 0px;
    }

    /* üî∏ –ö–Ω–æ–ø–∫–∏ */
    .navbar a {
      background-color: #2563eb;
      color: white;
      text-decoration: none;
      padding: 12px 40px;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    /* üî∏ –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    .navbar a:hover {
      background-color: #1d4ed8;
      transform: translateY(-2px);
    }

    /* üî∏ –î–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–∞–¥–∞–ø—Ç–∏–≤) */
    @media (max-width: 600px) {
      .navbar {
        flex-direction: column;
        align-items: stretch;
      }
      .navbar a {
        width: 100%;
        text-align: center;
      }
    }
  </style>
  </body>
 
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ù–∞–ª–æ–≥–æ–≤—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
      function TaxCalculator() {
        const [income, setIncome] = React.useState(500000);
        const [incomePeriod, setIncomePeriod] = React.useState("annual");
        const [deductions, setDeductions] = React.useState(0);
        const [useProgressive, setUseProgressive] = React.useState(false);
        const [flatRate, setFlatRate] = React.useState(13);
        const [brackets, setBrackets] = React.useState([
          { upTo: 100000, rate: 10 },
          { upTo: 300000, rate: 20 },
          { upTo: null, rate: 30 },
        ]);
        const [history, setHistory] = React.useState([]);

        React.useEffect(() => {
          const saved = localStorage.getItem('tax_calc_html');
          if (saved) {
            const p = JSON.parse(saved);
            setIncome(p.income || 0);
            setIncomePeriod(p.incomePeriod || 'annual');
            setDeductions(p.deductions || 0);
            setUseProgressive(p.useProgressive || false);
            setFlatRate(p.flatRate || 13);
            setBrackets(p.brackets || []);
            setHistory(p.history || []);
          }
        }, []);

        React.useEffect(() => {
          localStorage.setItem('tax_calc_html', JSON.stringify({ income, incomePeriod, deductions, useProgressive, flatRate, brackets, history }));
        }, [income, incomePeriod, deductions, useProgressive, flatRate, brackets, history]);

        const toAnnual = (v, p) => (p === 'monthly' ? v * 12 : v);
        const format = (v) => v.toLocaleString('ru-RU', { maximumFractionDigits: 2 });

        function calc() {
          const annualIncome = toAnnual(+income, incomePeriod);
          const taxable = Math.max(0, annualIncome - +deductions);
          let tax = 0;
          if (!useProgressive) {
            tax = taxable * flatRate / 100;
          } else {
            let remain = taxable, lower = 0;
            for (const b of brackets) {
              const upTo = b.upTo == null ? Infinity : b.upTo;
              const part = Math.min(remain, upTo - lower);
              if (part > 0) tax += part * b.rate / 100;
              remain -= part;
              lower = upTo;
              if (remain <= 0) break;
            }
          }
          const net = annualIncome - tax;
          return { annualIncome, taxable, tax, net, netMonthly: net/12 };
        }

        const res = calc();

        return (
          <div className="max-w-3xl mx-auto p-6">
             <br></br>
            <h1 className="text-2xl font-bold mb-4">–ù–∞–ª–æ–≥–æ–≤—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h1>

            <div className="space-y-3 bg-white p-4 rounded shadow">
              <div>
                <label>–î–æ—Ö–æ–¥:</label>
                <div className="flex gap-2 mt-1">
                  <input type="number" value={income} onChange={e=>setIncome(+e.target.value)} className="border p-2 rounded flex-1"/>
                  <select value={incomePeriod} onChange={e=>setIncomePeriod(e.target.value)} className="border p-2 rounded">
                    <option value="annual">–ì–æ–¥–æ–≤–æ–π</option>
                    <option value="monthly">–ú–µ—Å—è—á–Ω—ã–π</option>
                  </select>
                </div>
              </div>

              <div>
                <label>–í—ã—á–µ—Ç—ã:</label>
                <input type="number" value={deductions} onChange={e=>setDeductions(+e.target.value)} className="border p-2 rounded w-full mt-1"/>
              </div>

              <div className="flex items-center gap-2">
                <input type="checkbox" checked={useProgressive} onChange={e=>setUseProgressive(e.target.checked)}/>
                <label>–ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —à–∫–∞–ª–∞</label>
              </div>

              {!useProgressive && (
                <div>
                  <label>–ü–ª–æ—Å–∫–∞—è —Å—Ç–∞–≤–∫–∞ (%)</label>
                  <input type="number" value={flatRate} onChange={e=>setFlatRate(+e.target.value)} className="border p-2 rounded w-full mt-1"/>
                </div>
              )}

              {useProgressive && (
                <div className="space-y-2">
                  {brackets.map((b, i)=>(
                    <div key={i} className="flex gap-2">
                      <input type="number" placeholder="–¥–æ" value={b.upTo ?? ''} onChange={e=>{
                        const v=e.target.value===''?null:+e.target.value;
                        setBrackets(brackets.map((x,j)=>j===i?{...x,upTo:v}:x));
                      }} className="border p-2 rounded flex-1"/>
                      <input type="number" placeholder="%" value={b.rate} onChange={e=>setBrackets(brackets.map((x,j)=>j===i?{...x,rate:+e.target.value}:x))} className="border p-2 rounded w-24"/>
                    </div>
                  ))}
                  <button onClick={()=>setBrackets([...brackets,{upTo:null,rate:0}])} className="bg-blue-500 text-white px-3 py-1 rounded">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
              )}

              <div className="p-4 bg-gray-50 rounded mt-4">
                <div>–ì–æ–¥–æ–≤–æ–π –¥–æ—Ö–æ–¥: <b>{format(res.annualIncome)}</b></div>
                <div>–û–±–ª–∞–≥–∞–µ–º—ã–π: <b>{format(res.taxable)}</b></div>
                <div>–ù–∞–ª–æ–≥: <b className="text-red-600">{format(res.tax)}</b></div>
                <div>–ß–∏—Å—Ç—ã–π –≥–æ–¥–æ–≤–æ–π: <b>{format(res.net)}</b></div>
                <div>–ß–∏—Å—Ç—ã–π –≤ –º–µ—Å—è—Ü: <b>{format(res.netMonthly)}</b></div>
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<TaxCalculator/>);
    </script>
  </body>
</html>

